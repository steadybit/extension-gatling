package extgatling

import (
	"github.com/rs/zerolog/log"
	"github.com/steadybit/action-kit/go/action_kit_api/v2"
	"github.com/steadybit/extension-kit/extutil"
	"strings"
)

const (
	actionId   = "com.steadybit.extension_gatling.run"
	actionIcon = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNNi43NTU3MSAxNC4zMjA4QzUuNzE1NTIgMTUuNzU1NyAzLjg5NTE5IDE2LjA0MjcgMi41NjAyOCAxNS4wNTYyQzEuMTczMzYgMTQuMDUxNyAwLjgyNjYzNSAxMi4wNjA4IDEuODE0ODEgMTAuNjI1OUMyLjczMzY1IDkuMjA4OTMgNC43NDQ2OCA4Ljc0MjU4IDYuMDEwMjQgOS44MzY3QzcuMDE1NzYgMTAuNzE1NiA4LjA3MzI5IDEwLjM5MjcgOS4xMzA4MSAxMC40NDY1QzkuNTk4OSAxMC40NjQ1IDkuMzA0MTggMTAuMDY5OSA5LjIxNzQ5IDkuODkwNTFDOC4yNjM5OSA3Ljg0NTc3IDYuMDEwMjQgNi41NzIyOSAzLjgwODUxIDYuODA1NDZDMi44MDI5OSA2Ljg5NTE0IDEuOTAxNSA3LjMwNzY4IDEgNy43NzQwMkMxLjg4NDE2IDYuODIzNCAzLjA4MDM4IDYuMjEzNTYgNC4zNDU5NCA2LjA3MDA3QzYuOTYzNzUgNS43NDcyMiA5LjE2NTQ4IDYuNTE4NDggMTAuNzQzMSA4LjgzMjI3QzEwLjk1MTEgOS4xMzcxOCAxMS4xOTM5IDkuMTczMDYgMTEuNDg4NiA5LjE3MzA2QzEyLjcxOTUgOS4xNTUxMiAxMy45ODUgOS4xOTA5OSAxNS4yMTU5IDkuMTczMDZDMTUuNjg0IDkuMTU1MTIgMTYuMDY1NCA5LjI5ODYxIDE2LjA2NTQgOS44MzY3QzE2LjA2NTQgMTAuMzc0OCAxNS42NjY3IDEwLjU1NDIgMTUuMjE1OSAxMC41NTQySDEyLjI2ODdDMTIuMDQzMyAxMC41NTQyIDExLjU5MjYgMTAuNDEwNyAxMS43MzEzIDEwLjkxMjlDMTEuODcgMTEuNDE1MSAxMS41NzUzIDExLjg5OTQgMTIuMzIwNyAxMS44OTk0QzEzLjc0MjMgMTEuODgxNCAxNS4xODEyIDExLjg5OTQgMTYuNjAyOCAxMS44OTk0QzE2LjgxMDkgMTEuODgxNCAxNy4wMTg5IDExLjkxNzMgMTcuMjA5NiAxMS45NzExQzE3LjU1NjMgMTIuMDYwOCAxNy43ODE3IDEyLjQxOTUgMTcuNzEyNCAxMi43OTYyQzE3LjY0MyAxMy4yNDQ2IDE3LjM2NTYgMTMuNDA2IDE2Ljk4NDIgMTMuNDI0QzE2LjI3MzQgMTMuNDU5OCAxNS41NjI2IDEzLjQ0MTkgMTQuODM0NSAxMy40NDE5QzE0LjEwNjQgMTMuNDQxOSAxMy4xMzU1IDEzLjQ1OTggMTIuMjg2MSAxMy40NDE5QzExLjQzNjYgMTMuNDI0IDExLjY5NjYgMTQuMTIzNSAxMS42MDk5IDE0LjUxODFDMTEuNTQwNiAxNC45MTI3IDExLjk5MTMgMTQuNzY5MiAxMi4yMTY3IDE0Ljc4NzFIMTUuMTgxMkMxNS42NjY3IDE0Ljc4NzEgMTYuMDgyNyAxNC45NjY1IDE2LjA2NTQgMTUuNTIyNUMxNi4wNDgxIDE2LjA5NjUgMTUuNjMyIDE2LjE2ODIgMTUuMTYzOSAxNi4xNTAzQzEzLjg0NjMgMTYuMTMyMyAxMi41Mjg4IDE2LjE2ODIgMTEuMjI4NSAxNi4xMzIzQzEwLjg2NDUgMTYuMTMyMyAxMC42MjE3IDE2LjIyMiAxMC40MTM3IDE2LjU0NDlDMTAuMDQ5NiAxNy4xMDA5IDkuNDk0ODggMTcuNDU5NiA4Ljg1MzQzIDE4LjAxNTdIMTMuNjU1NkMxNi4yNzM0IDE4LjAxNTcgMTguNDU3OCAxNS45NTMgMTguNjY1OSAxMy4yOTg0QzE4Ljg1NjYgMTAuNjQzOCAxNy4wMzYyIDguMTMyNzUgMTQuNDE4NCA3LjcyMDIxQzEzLjgxMTcgNy42MzA1MyAxMy4xODc1IDcuNjQ4NDcgMTIuMzkwMSA3LjU3NjcyQzEzLjQ0NzYgNy4wOTI0NCAxNC40MDExIDcuMDU2NTcgMTUuMzU0NiA3LjA3NDUxQzE2Ljk4NDIgNy4wNzQ1MSAxOC4zODg1IDcuNjEyNiAxOS40OTggOC44NjgxNEMxOS43NDA3IDkuMTczMDYgMjAuMDM1NSA5LjE5MDk5IDIwLjM0NzUgOS4xNzMwNkMyMC42NzY5IDkuMTU1MTIgMjEuMTEwMyA5LjE5MDk5IDIxLjIzMTcgOS42Mzk0QzIxLjM1MyAxMC4xMDU3IDIxLjE2MjMgMTAuMzIxIDIwLjc4MDkgMTAuNTAwM0MyMC40MTY5IDEwLjY3OTcgMjAuNzQ2MyAxMS4xMTAyIDIwLjcyODkgMTEuNDMzQzIwLjcxMTYgMTEuNzU1OSAyMC44MTU2IDExLjkzNTIgMjEuMTc5NyAxMS44OTk0QzIxLjQwNSAxMS44NjM1IDIxLjY0NzggMTEuODk5NCAyMS44NTU4IDEyLjAwN0MyMi4wOTg1IDEyLjE4NjQgMjIuMjU0NSAxMi40MTk1IDIyLjE4NTIgMTIuNzQyNEMyMi4xMTU4IDEzLjA2NTIgMjEuODU1OCAxMy4yNjI1IDIxLjQ3NDQgMTMuMjk4NEMyMS4xMTAzIDEzLjMzNDMgMjAuODUwMyAxMy4xMTkgMjAuODMyOSAxMy41ODU0QzIwLjgxNTYgMTQuMDUxNyAyMC4zNDc1IDE0LjQ4MjIgMjEuMDIzNiAxNC44NzY4QzIxLjY5OTggMTUuMjcxNCAyMS4zNTMgMTYuMTUwMyAyMC44Njc2IDE2LjA5NjVDMTkuNzA2MSAxNi4wMDY4IDE5LjM3NjcgMTcuMDI5MiAxOC40NTc4IDE3LjYyMTFDMjAuMDUyOCAxNy44NTQyIDIxLjUwOTEgMTcuNzEwNyAyMyAxOC4yNDg4QzIyLjI4OTIgMTguNjc5MyAyMS42MTMxIDE4LjY3OTMgMjAuOTcxNiAxOC43MTUyQzE3LjQ1MjMgMTkuMDM4IDEzLjkzMyAxOC45ODQyIDEwLjQxMzcgMTguOTY2M0M4LjM2ODAxIDE4Ljk0ODMgNi4zMDQ5NiAxOS4wOTE4IDQuMjU5MjYgMTguODk0NUMzLjE0OTcyIDE4Ljc2OSAyLjEyNjg3IDE4LjIzMDkgMS4xOTA3IDE3LjQ1OTZDMS41ODk0NCAxNy4zNyAxLjgzMjE1IDE3LjYwMzEgMi4wOTIyIDE3LjcyODdDNS42NjM1MSAxOS40MTQ3IDkuODU4OTQgMTYuNjE2NiA5Ljg0MTYxIDEyLjU4MUM5LjgyNDI3IDEyLjA3ODcgOS42NjgyNCAxMS45MzUyIDkuMjAwMTYgMTEuOTUzMkM4LjIyOTMxIDExLjk4OTEgNy4yMjM4IDExLjkzNTIgNi4yMzU2MiAxMS45NzExQzUuMjEyNzcgMTEuOTg5MSA0LjMxMTI3IDEyLjcwNjUgNC4wNTEyMiAxMy43Mjg5QzMuOTQ3MiAxNC4xMjM1IDMuOTgxODggMTQuMzU2NyA0LjQ4NDYzIDE0LjMzODdDNC45NzAwNiAxNC4zMDI4IDUuMjEyNzcgMTQuMzIwOCA1LjU5NDE3IDE0LjMyMDhINi43NTU3MVoiIGZpbGw9ImN1cnJlbnRDb2xvciIgLz48L3N2Zz4="
)

func stdOutToLog(lines []string) {
	for _, line := range lines {
		trimmed := strings.TrimSpace(strings.ReplaceAll(line, "\n", ""))
		if len(trimmed) > 0 {
			log.Info().Msgf("---- %s", trimmed)
		}
	}
}

func stdOutToMessages(lines []string) []action_kit_api.Message {
	messages := make([]action_kit_api.Message, 0)
	for _, line := range lines {
		trimmed := strings.TrimSpace(strings.ReplaceAll(line, "\n", ""))
		if len(trimmed) > 0 {
			messages = append(messages, action_kit_api.Message{
				Level:   extutil.Ptr(action_kit_api.Info),
				Message: trimmed,
			})
		}
	}
	return messages
}
